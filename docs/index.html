<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Andrea Leoncini, based on Bootstrap contributors">
    <title>MR Tool</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="css/mrt.css" rel="stylesheet">

    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="img/RedHat_favicon_0319.Small-logo-transparent.png" />

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

</head>
<body style="padding-top: 3.5rem">
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <img src="img/transparent_spacer.png" width="50" height="32"><img src="img/logo.svg" width="135" height="32">
</nav>

<main role="main">

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
        <div class="container">
            <h1 class="display-3">Mileage Report Tool</h1>
            <p class="lead">Simplify your life. Save time. Do the right things. Send the report each month!</p>
            <p id="the_response"></p>
            <br><br>
        </div>
    </div>

    <div class="alert alert-danger" id="formNotComplete" role="alert" style="display:none;"></div>

    <div class="container" id="current_report" style="display:none">
        <table class="table table-condensed table-hover" id="tbl_trips">
            <thead>
                <tr class="tb_header"><th>Date</th><th>Odometer start (km)</th><th>From – location (City/Country)</th><th>To – location [City/Country}</th><th>Purpose and/or customer</th><th>Odometer End (km)</th><th>Mileage (km)</th><th>&nbsp;</th></tr>
            </thead>
            <tbody id="tripsTableBody">
            </tbody>
        </table>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#tripForm">
            Add Trip
        </button>
    </div>

</main>

<footer class="container">
    <hr>
    <p>&copy; Red Hat Italy 2024-2027</p>
</footer>

<!-- Modal form to redirect to associate info settings page-->
<div class="modal fade" id="tripForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Add Trip to Report</h5>
            </div>

            <div class="modal-body">
                <p>The odometer start is calculated starting from the latest odometer end, anyway you can overwrite it.</p>
                <div class="mb-3">
                    <label for="dateInput" class="form-label">Date of the Trip</label>
                    <input type="date" class="form-control" id="dateInput">
                </div>
                <div class="mb-3">
                    <label for="fromLocationInput" class="form-label">From – location (City or Country)</label>
                    <input type="text" class="form-control" id="fromLocationInput">
                </div>
                <div class="mb-3">
                    <label for="toLocationInput" class="form-label">To – location (City or Country)</label>
                    <input type="text" class="form-control" id="toLocationInput">
                </div>
                <div class="mb-3">
                    <label for="purposeInput" class="form-label">Purpose and/or customer</label>
                    <input type="text" class="form-control" id="purposeInput">
                </div>
                <div class="mb-3">
                    <label for="odoStartInput" class="form-label">Odometer start (km)</label>
                    <input type="text" class="form-control" id="odoStartInput">
                </div>
                <div class="mb-3">
                    <label for="distanceInput" class="form-label">Trip distance (km)</label>
                    <input type="text" class="form-control" id="distanceInput">
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="" id="twoWayCheck" checked>
                    <label class="form-check-label" for="twoWayCheck">
                        Two ways trip
                    </label>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button id="saveTripButton" type="button" class="btn btn-outline-primary">Save</button>
            </div>

        </div>
    </div>
</div>

    <!-- JavaScript libraries-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="js/jquery-3.7.1.min.js"></script>
    <script src="js/mrt.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {

            displayAllTrips();

            $('#saveTripButton').click(function(){
                $("#tripForm").modal('hide');
                var trip = {};

                if ($('#dateInput').val().length == 0) {
                    setAlert('Please insert a valid Date for Trip');
                    return;
                }
                var t_date = new Date($('#dateInput').val());
                trip.date = t_date.toLocaleDateString('it-IT', options);

                if ($('#fromLocationInput').val().length == 0) {
                    setAlert('Please insert a location where the trip started from');
                    return;
                }
                trip.from = $('#fromLocationInput').val();
                console.log("======> " + trip.from);

                if ($('#toLocationInput').val().length == 0) {
                    setAlert('Please insert a location of destination');
                    return;
                }
                trip.destination = $('#toLocationInput').val();
                console.log("======> " + trip.destination);

                if ($('#purposeInput').val().length == 0) {
                    setAlert('Please insert customer name or purpose of the visit');
                    return;
                }
                trip.purpose = $('#purposeInput').val();
                console.log("======> " + trip.purpose);

                if (($('#odoStartInput').val().length == 0) || (isNaN($('#odoStartInput').val()))) {
                    setAlert('Please insert a numeric value in the Odometer Start Field');
                    return;
                }
                trip.odometerStart = parseInt($('#odoStartInput').val());
                console.log("======> " + trip.odometerStart);

                if (($('#distanceInput').val().length == 0) || (isNaN($('#distanceInput').val()))) {
                    setAlert('Please insert a numeric value in the Distance Field');
                    return;
                }
                trip.distance = parseInt($('#distanceInput').val());
                console.log("======> " + trip.distance);

                trip.twoWays = $('#twoWayCheck').is(":checked");
                if(trip.twoWays){
                    console.log("======> check is true  " + trip.twoWays);
                }

                trip.odometerEnd = (trip.odometerStart + trip.distance);
                trip.latestOdometer = trip.odometerEnd;

                addTripToTable(trip);
                var trips = JSON.parse(localStorage.getItem("mrtTrips") || "[]");
                trips.push(trip);
                localStorage.setItem('mrtTrips', JSON.stringify(trips));
                console.log("======> number of trips  " + trips.length);
            });

            $(document).on("click", ".delete_trip", function () {
                $(this).parent().remove();
            });

        });

    </script>

</body>
</html>